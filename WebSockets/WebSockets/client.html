<html>
<head>
<title>WebSocket</title>
<style type="text/css">
html,body {
	font:normal 0.9em arial,helvetica;
}
#log {
	width:600px; 
	height:300px; 
	border:1px solid #7F9DB9; 
	overflow:auto;
}
#msg {
	width:400px;
}
#alias {
	width:200px;
}
</style>
<script type="text/javascript">
var socket;

function init() {
	var host = "ws://localhost:9000"; 
	try {
		socket = new WebSocket(host);
		log('WebSocket - estado '+socket.readyState);
		socket.onopen = function(msg) { 
			log("Conectado - estado "+this.readyState); 
		};
		socket.onmessage = function(msg) { 
			log(msg.data); // Mostramos el mensaje completo recibido
		};
		socket.onclose = function(msg) { 
			log("Desconectado - estado "+this.readyState); 
		};
	}
	catch(ex){ 
		log(ex); 
	}
	$("msg").focus();
}

function send(){
	var txtMsg = $("msg");
	var txtAlias = $("alias");
	var msg = txtMsg.value;
	var alias = txtAlias.value;

	if(!alias) {
		alert("Porfavor ingresar alias");
		txtAlias.focus();
		return;
	}

	if(!msg) { 
		alert("El mensaje no puede estar vacio"); 
		txtMsg.focus();
		return; 
	}

	txtMsg.value = "";
	txtMsg.focus();
	try { 
		// Enviamos mensaje con alias separado por ":::"
		socket.send(alias + "::: " + msg); 
		log(alias + ": " + msg); // También lo mostramos en tu pantalla
	} catch(ex) { 
		log(ex); 
	}
}

function quit(){
	if (socket != null) {
		log("Adiós!");
		socket.close();
		socket=null;
	}
}

function reconnect() {
	quit();
	init();
}

// Utilities
function $(id){ return document.getElementById(id); }
function log(msg){ $("log").innerHTML += "<br>" + msg; }
function onkey(event){ if(event.keyCode==13){ send(); } }
</script>

</head>
<body onload="init()">
<h3>WebSocket v2.00</h3>
<div id="log"></div>
<input id="alias" type="text" placeholder="Alias"/>
<input id="msg" type="text" onkeypress="onkey(event)" placeholder="Type message"/>
<button onclick="send()">Enviar</button>
<button onclick="quit()">Salir</button>
<button onclick="reconnect()">Reconectar</button>
</body>
</html>
